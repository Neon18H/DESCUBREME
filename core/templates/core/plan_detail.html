{% extends 'base.html' %}
{% block content %}
<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center">
    <div><h2>{{ plan.title }}</h2><span class="badge text-bg-info">{{ plan.city }}</span>{% if plan.is_shared %}<span class="badge text-bg-success">Compartido</span>{% endif %}</div>
    <div>{{ joins_count }} apuntados</div>
  </div>
  <div class="my-3">
    {% if user == plan.owner %}
    <form method="post" action="{% url 'plan_share' plan.id %}" class="d-inline">{% csrf_token %}
      <input type="hidden" name="is_shared" value="{% if plan.is_shared %}false{% else %}true{% endif %}">
      <button class="btn btn-outline-light btn-sm">{% if plan.is_shared %}Dejar de compartir{% else %}Compartir{% endif %}</button>
    </form>
    {% endif %}
    {% if joined %}
    <form method="post" action="{% url 'plan_unjoin' plan.id %}" class="d-inline">{% csrf_token %}<button class="btn btn-warning btn-sm">Salir</button></form>
    {% else %}
    <form method="post" action="{% url 'plan_join' plan.id %}" class="d-inline">{% csrf_token %}<button class="btn btn-primary btn-sm">Apuntarme</button></form>
    {% endif %}
  </div>
  {% for label, items in grouped_items.items %}
    <h5 class="mt-3">{{ label }}</h5>
    {% for item in items %}<div class="card bg-dark text-light mb-2"><div class="card-body">{{ item.name }} · {{ item.address }}</div></div>{% endfor %}
  {% endfor %}
  <h4 class="mt-4">Comentarios</h4>
  <form method="post" action="{% url 'plan_comment' plan.id %}">{% csrf_token %}{{ comment_form.body }}<button class="btn btn-primary btn-sm mt-2">Comentar</button></form>
  <div class="mt-3">
    {% for comment in comments %}<div class="list-group-item bg-dark text-light border-secondary mb-2"><strong>@{{ comment.user.username }}</strong> {{ comment.body }}</div>{% empty %}<p>Aún no hay comentarios.</p>{% endfor %}
  </div>
</div>
{% endblock %}
